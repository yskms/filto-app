# Feeds（フィード管理）

## 概要
登録済みRSSフィードの一覧・並び替え・削除を行う画面。

## 画面配置
- **パス**: `app/(tabs)/feeds.tsx`
- **タブグループ**: タブグループ内（ボトムタブ表示あり）
- **タブバー表示**: あり（4タブの1つ：Home / Filters / Feeds / Settings）
- **ボトムタブ**: Home / Filters / Feeds / Settings の4タブのうち Feeds として表示

**注意**: Feeds はボトムタブのひとつ。Settings からのリンクはない。他画面へはタブで切り替える。

## UI構成

### 通常モード
- ヘッダー
  - 左：（タブ画面のため戻るボタンなし）
  - 中央：Feeds
  - 右：🔄アイコン（ソートモーダル）、🗑アイコン（削除モード切替）、＋ボタン（追加）
- フィードリスト
  - 左：アイコン（フィードアイコンまたは📰）
  - 中：フィード名 + URL
- **下部：ボトムタブバー**（Home / Filters / Feeds / Settings）

### 削除モード
- ヘッダー（切り替わる）
  - 左：キャンセル（青文字）
  - 中央：「N件選択」
  - 右：削除（赤文字、0件時は無効化）
- フィードリスト
  - タップで選択トグル
  - 選択行は背景色変更（#e3f2fd）
  - ドラッグ無効
  - スワイプ無効
- 右下：＋ボタン（表示維持、操作は可能）
- **下部：ボトムタブバー**（Home / Filters / Feeds / Settings）

## 表示仕様

### ソート順
- デフォルト：`created_at DESC`（作成日時が新しい順）
- ユーザーが選択可能なソートオプション：
  - 作成日時（新しい順）
  - 作成日時（古い順）
  - フィード名（昇順）
  - フィード名（降順）
  - URL（昇順）
  - URL（降順）
- ソート状態は画面表示中のみ保持（永続化なし）

## 操作

### 通常モード
- **🔄ボタン**：ソートモーダル表示
- 左スワイプ：削除ボタン表示 → 個別削除
- ＋ボタン：FeedAddへ遷移
- 🗑アイコン：削除モードに切替

### 削除モード
- 行タップ：選択/選択解除をトグル
- 削除ボタン：確認ダイアログ → 一括削除実行
- キャンセル：選択クリア & 通常モードに戻る

## 削除フロー

### 個別削除（スワイプ）
1. フィード行を左にスワイプ
2. 赤背景 + 🗑アイコンの削除ボタン表示
3. 削除ボタンタップ
4. 確認ダイアログ表示
   - タイトル：「フィードを削除」
   - メッセージ：「このフィードを削除しますか？」
5. 削除実行 → スワイプを閉じる

### 一括削除（削除モード）
1. 🗑アイコンタップ → 削除モード突入
2. 削除したいフィードを複数選択
3. 「削除」ボタンタップ
4. 確認ダイアログ表示
   - タイトル：「N件のフィードを削除しますか？」
   - メッセージ：「この操作は取り消せません」
5. 削除実行 → 通常モードに戻る

## ソート機能

### 操作フロー
1. ヘッダー右上の🔄ボタンをタップ
2. ソートモーダル（中央表示）が開く
3. ソートオプション（6つ）から選択
4. モーダル閉じる → フィード一覧が自動的に再ソート

### ソートオプション
| オプション | SQL ORDER BY |
|-----------|--------------|
| 作成日時（新しい順） | `created_at DESC` |
| 作成日時（古い順） | `created_at ASC` |
| フィード名（昇順） | `title COLLATE NOCASE ASC` |
| フィード名（降順） | `title COLLATE NOCASE DESC` |
| URL（昇順） | `url ASC` |
| URL（降順） | `url DESC` |

### 実装詳細
- **State**: `currentSort: FeedSortType`（デフォルト: `created_at_desc`）
- **永続化**: なし（画面表示中のみ保持）
- **モーダル**: `FeedSortModal`コンポーネント（Filters画面と同じパターン）
- **データ取得**: `FeedService.listWithSort(sortType)`

---

## スワイプ削除の挙動

### 基本ルール
- スワイプで削除ボタンを表示できる行は常に1件のみ
- 削除モード中はスワイプ操作を無効化

### スワイプを閉じる条件
スワイプが開いている状態で以下の操作が行われた場合、既存のスワイプを閉じる：
- 同一行のタップ
- 別行のタップ
- 別行のスワイプ操作
- 🔄ボタンタップ（ソートモーダル表示）
- ＋ボタンタップ
- 🗑アイコンタップ（削除モード突入）
- Tabs 切り替え・画面遷移時
  - Feeds 画面のフォーカスが外れるタイミングで開いている Swipeable をすべて close する
  - スワイプ状態は画面間で持ち越さない

### スワイプ中の操作制限
- スワイプが開いている間は以下の操作が無効：
  - 行タップ → スワイプを閉じるのみ

## 使用データ
- feeds

## 使用API / Service
- FeedService.list()
- FeedService.reorder()
- FeedService.delete(id: number)  // 個別削除
- FeedService.delete(ids: number[])  // 一括削除

## 遷移

### ヘッダーからの遷移
- **＋ボタン** → FeedAdd

### ボトムタブからの遷移
- **Homeタブ** → Home画面
- **Filtersタブ** → Filters画面
- **Feedsタブ** → Feeds画面（自画面）
- **Settingsタブ** → Settings画面

**実装パス**:
- Feeds: `app/(tabs)/feeds.tsx`
- Settings: `app/(tabs)/settings.tsx`
- FeedAdd: `app/feed_add.tsx`（タブグループ外）
