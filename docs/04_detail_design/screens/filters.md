# Filters（フィルタ一覧）

## 概要
登録済みフィルタ条件の一覧表示・編集・削除・並び替えを行う。

## UI構成

### 通常モード
- ヘッダー
  - 左：タイトル（Filters）
  - 右：🔄ソート + 🗑削除モード + ＋追加
- フィルタリスト
  - 1行目：block_keyword（太字）
  - 2行目：allow_keywordがある場合「許可: {allow_keyword}」
  - 右：✏️編集アイコン

### 削除モード
- ヘッダー（切り替わる）
  - 左：キャンセル（青文字）
  - 中央：「N件選択」
  - 右：削除（赤文字、0件時は無効化）
- フィルタリスト
  - タップで選択トグル
  - 選択行は背景色変更（#e3f2fd）
  - スワイプ無効
  - 編集アイコン表示維持（操作は無効）

## ソート機能（NEW）

### ソートボタン
- 位置：ヘッダー右側（🗑の左）
- アイコン：🔄
- タップ時：ソートメニュー表示

### ソートメニュー（ボトムシート or モーダル）
```
┌──────────────────────────┐
│ 並び替え                  │
├──────────────────────────┤
│ ▶ ブロックキーワード       │ ← 現在の並び順（▶で表示）
│   作成日時（新しい順）     │
│   作成日時（古い順）       │
│   更新日時（新しい順）     │
│   更新日時（古い順）       │
└──────────────────────────┘
```

### ソート項目
1. **ブロックキーワード**（デフォルト）
   - 昇順（あいうえお順、ABC順）
   - 重複キーワードの確認に便利

2. **作成日時（新しい順）**
   - 最近追加したフィルタが上に

3. **作成日時（古い順）**
   - 昔からあるフィルタが上に

4. **更新日時（新しい順）**
   - 最近編集したフィルタが上に
   - 編集後の確認に便利

5. **更新日時（古い順）**
   - 長期間編集していないフィルタが上に

### ソート状態の保存
- 選択したソート順は Settings に保存
- アプリ再起動後も維持
- デフォルト：ブロックキーワード昇順

### 重複の確認方法
ブロックキーワード順でソート → 同じキーワードが隣接して表示
```
例:
┌────────────────────────┐
│ FX                ✏️  │
│ 許可: 仮想通貨         │
├────────────────────────┤
│ FX                ✏️  │ ← 重複が一目瞭然
│ 許可: web3            │
├────────────────────────┤
│ FX                ✏️  │
│ 許可: 投資            │
└────────────────────────┘
```

## 操作

### 通常モード
- 行タップ：編集画面へ遷移（将来実装）
- ✏️アイコン：編集画面へ遷移（将来実装）
- 左スワイプ：削除ボタン表示 → 個別削除
- 🔄ボタン：ソートメニュー表示
- ＋ボタン：新規追加画面へ遷移
- 🗑アイコン：削除モードに切替

### 削除モード
- 行タップ：選択/選択解除をトグル
- 削除ボタン：確認ダイアログ → 一括削除実行
- キャンセル：選択クリア & 通常モードに戻る

## 削除フロー

### 個別削除（スワイプ）
1. フィルタ行を左にスワイプ
2. 赤背景 + 🗑アイコンの削除ボタン表示
3. 削除ボタンタップ
4. 確認ダイアログ表示
   - タイトル：「フィルタを削除」
   - メッセージ：「このフィルタを削除しますか？」
5. 削除実行 → スワイプを閉じる

### 一括削除（削除モード）
1. 🗑アイコンタップ → 削除モード突入
2. 削除したいフィルタを複数選択
3. 「削除」ボタンタップ
4. 確認ダイアログ表示
   - タイトル：「N件のフィルタを削除しますか？」
   - メッセージ：「この操作は取り消せません」
5. 削除実行 → 通常モードに戻る

## スワイプ削除の挙動

### 基本ルール
- スワイプで削除ボタンを表示できる行は常に1件のみ
- 削除モード中はスワイプ操作を無効化する

### スワイプを閉じる条件
スワイプが開いている状態で以下の操作が行われた場合、既存のスワイプを閉じる：
- 同一行のタップ
- 別行のタップ（編集アイコン含む）
- 別行のスワイプ操作
- 🔄ボタンタップ（ソートメニュー表示）
- ＋ボタンタップ
- 🗑アイコンタップ（削除モード突入）
- Tabs 切り替え・画面遷移時
  - Filters 画面のフォーカスが外れるタイミングで開いている Swipeable をすべて close する
  - スワイプ状態は画面間で持ち越さない

### スワイプ中の操作制限
- スワイプが開いている間は以下の操作が無効：
  - 編集アイコンタップ → スワイプを閉じるのみ
  - 行タップ → スワイプを閉じるのみ

## 多言語対応

### allow_keyword の表示
- 日本語：「許可: {allow_keyword}」
- English：「Allow: {allow_keyword}」
- 言語設定は将来的にSettingsから取得予定
- 現在は固定で日本語表示

## Pro版の制限

### 無料版
- フィルタ数：**100個まで**
- 100個到達時：＋ボタンタップで Pro 誘導ダイアログ

### Pro版
- フィルタ数：**無制限**

### 上限到達時の挙動
```
Alert表示:
タイトル: フィルタの上限
メッセージ: 無料版では100個までフィルタを作成できます。
ボタン:
  - キャンセル
  - Pro版を見る → /settings/pro へ遷移
```

## 使用データ
- filters

## 使用API / Service
- FilterService.list()
- FilterService.delete(id: number)  // 個別削除
- FilterService.delete(ids: number[])  // 一括削除

## 設定データ
```typescript
settings:
  key: 'filter_sort_order'
  value: 'block_keyword' | 'created_asc' | 'created_desc' | 'updated_asc' | 'updated_desc'
```

## 遷移
- → FilterEdit（編集/新規追加）
- ← Tab

## ブロックキーワードの重複について

### 仕様
- **重複を完全に許可**
- 警告なし
- チェックなし

### 確認方法
- ソート機能で「ブロックキーワード」順にする
- 同じキーワードが隣接して表示される
- 重複を見つけたら、編集または削除で整理できる

### 重複を許可する理由
```
同じキーワードでも、異なる許可条件で管理したい場合がある:

フィルタ1: FX → 仮想通貨は許可
フィルタ2: FX → web3は許可
フィルタ3: FX → 投資は許可

→ それぞれ異なる文脈で管理できる
```